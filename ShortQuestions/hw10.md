# Homework 10

## Yirun Wang

### 2. what is @configuration and @bean?

`@Configuration` is used to mark a class as a configuration class in Spring. It indicates that the class can be used by the Spring IoC container as a source of bean definitions. Furthermore, `@Configuration` classes let inter-bean dependencies be defined by calling other `@Bean` methods in the same class. 

```java
@Configuration
public class AppConfig {

	@Bean
	public MyServiceImpl myService() {
		return new MyServiceImpl();
	}
}
```

`@Bean` is used to indicate that a method produces a bean to be managed by the Spring container, making it available for dependency injection throughout the application.

### 3. How do you handle the exceptions in Spring? How do you make sure you do NOT expose sensitive information?

1. **Using @ExceptionHandler in Controllers** - Method Level

   used to handle the specific exceptions and sending the custom responses to the client

```java
@RestController
public class MyController {

    @GetMapping("/resource")
    public String getResource() {
        if (true) { // Simulate an error
            throw new ResourceNotFoundException("Resource not found");
        }
        return "resource";
    }

    @ExceptionHandler(ResourceNotFoundException.class)
    public ResponseEntity<String> handleResourceNotFound(ResourceNotFoundException ex) {
        return new ResponseEntity<>(ex.getMessage(), HttpStatus.NOT_FOUND);
    }
}

```



**2. Using @ControllerAdvice for Global Exception Handling** - Class Level

`@ControllerAdvice` is used to handle exceptions globally across multiple controllers. Make the class a bean.

```java
@ControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(ResourceNotFoundException.class)
    public ResponseEntity<String> handleResourceNotFound(ResourceNotFoundException ex) {
        return new ResponseEntity<>(ex.getMessage(), HttpStatus.NOT_FOUND);
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<String> handleGenericException(Exception ex) {
        return new ResponseEntity<>(ex.getMessage(), HttpStatus.INTERNAL_SERVER_ERROR);
    }
}

```



3. **Using ResponseEntityExceptionHandler**

`ResponseEntityExceptionHandler` is a convenient base class provided by Spring for global exception handling in RESTful services. You can extend this class and override its methods.

4. **Custom Error Pages**

configure custom error pages in `application.properties` for different HTTP status codes.

```
server.error.whitelabel.enabled=false
```

and create html templates for different errors.

### 4. How do you do validations in Spring? List some validation annotations you know. What's the purpose of validation?

1. Import Spring Boot Starter Validation dependency 

2. Add validation rule to payload

   ```java
   import javax.validation.constraints.*;
   
   public class User {
   
       @NotNull(message = "Name cannot be null")
       @Size(min = 2, max = 30, message = "Name must be between 2 and 30 characters")
       private String name;
   
       @NotNull(message = "Email cannot be null")
       @Email(message = "Email should be valid")
       private String email;
   
       @NotNull(message = "Age cannot be null")
       @Min(value = 18, message = "Age should not be less than 18")
       @Max(value = 100, message = "Age should not be more than 100")
       private Integer age;
   
       // Getters and setters
   }
   
   ```

3. Add @Valid to controller to apply the rule and trigger validation

   ```java
   @RestController
   @RequestMapping("/api/users")
   public class UserController {
   
       @PostMapping
       public ResponseEntity<String> createUser(@Valid @RequestBody User user) {
           // If validation fails, an error response will be returned automatically
           return new ResponseEntity<>("User is valid", HttpStatus.OK);
       }
   }
   ```

4. Handle validation errors

   ```java
   @ControllerAdvice
   public class GlobalExceptionHandler {
   
       @ExceptionHandler(MethodArgumentNotValidException.class)
       public ResponseEntity<Map<String, String>> handleValidationExceptions(MethodArgumentNotValidException ex) {
           Map<String, String> errors = new HashMap<>();
           ex.getBindingResult().getFieldErrors().forEach(error -> 
               errors.put(error.getField(), error.getDefaultMessage())
           );
           return new ResponseEntity<>(errors, HttpStatus.BAD_REQUEST);
       }
   }
   ```

**@NotNull**: The field must not be null.

**@NotEmpty**: The field must not be empty (for collections and strings).

**@NotBlank**: The field must not be blank (for strings).

**@Size(min=, max=)**: The field must be within the specified size range.

**@Min(value)**: The field must be greater than or equal to the specified value.

**@Max(value)**: The field must be less than or equal to the specified value.

**@Email**: The field must be a valid email address.

**@Pattern(regexp=)**: The field must match the specified regular expression.

**@Past**: The field must be a date in the past.

**@Future**: The field must be a date in the future.

**@Digits(integer=, fraction=)**: The field must be a number with specified integer and fraction digits.

**Purpose of Validation**:

- **Data Integrity**: Ensures that the data entering the system is correct and meets predefined rules.
- **User Feedback**: Provides clear and immediate feedback to users when they input invalid data.
- **Error Prevention**: Reduces the likelihood of errors occurring due to invalid data.

### 5. What is the actuator, list some endpoints and payload it provides?

**Spring Boot Actuator** provides production-ready features to help you monitor and manage your application. It includes a set of built-in endpoints that allow you to gather various metrics, check application health, view information about the environment, and more.

**Key Features of Spring Boot Actuator**

1. **Health Checks**: 

   **/actuator/health**: Shows application health information

2. **Metrics**:

    **/actuator/metrics**: Exposes metrics collected by the application.

3. **Environment Information**

   **/actuator/env**: Exposes properties from Spring's `Environment`.

4. **Application Information**:

   **/actuator/info**: Displays arbitrary application info.

5. **/actuator/loggers**: Shows and changes the logging level of the application.

6. **/actuator/beans**: endpoint provided by Spring Boot Actuator is used to display a complete list of all the beans that are available in the Spring ApplicationContext. 

