# HW13

## 1. List all of the annotations you learned from class and homework to annotaitons.md

- Please refer to annotations.md in ShortQuestions folder.

## 2. Explain TLS, PKI, certificate, public key, private key, and signature.

- TSL (Transport Layer Security): A protocol that provides secure communication over a computer network. It ensures privacy, integrity, and data security between two communicating applications.

- PKI (Public Key Infrastructure): A framework for managing digital keys and certificates. It facilitates secure electronic transfer of information through public key cryptograpy.

- Certificate: A digital document that uses a digital signature to bind a public key with an identity. It verifies the owenrship of a public key and enables secure communication.

- Public Key: It is a cryptography key that can be shared publicly and is used to encrypt data or verify a digital signature. It enables secure data exchange and digital signature verification.

- Private Key: It is a cryptographic key that is kept secret and is used to decrypt data or create a digital signature. 

- Signature: It is a cryptographic value that is calculated from the data and a private key. It ensures data integrity and authenticity by verifying the identity of the signer and that the data has not been altered.

## 3. List all http status codes that related to authentication and authorization failures

- 401 (Unauthorized): The request requires user authentication and it indicates that the client must authenticate itself to get the requested response.

- 403 (Forbidden): The server understands the request but refuses to authorize it. It indicates that the client does not have access rights to the content.

## 4. Compare authentication and authorization?

- Authentication: 
    - Verifying the identity of a user or system.
    - Ensures that the user or system is who they claim to be
    - Logging in with a username and password.

- Authorization:
    - Granting or denying access to resources or actions.
    - Determines what an authenticated user or system is allowed to do.
    - Checking permissions to access a specific file or perform an action.

- In general: Authentication means "Who are you" and Authorization means "What are you allowed to do"

## 5. What is HTTP Session?

- An HTTP session is a mechanism used to maintain state across multiple HTTP requests from the same user. It allows the server to store information about the user (e.g., login status, user preferences) and associate it with their subsequent requests, typically using a session ID stored in a cookie.

## 6. What is Cookie?

- A cookie is a small piece of data sent from a website and stored on a user's browser. It is used to remember information about the user between HTTP requests, such as login status or user preferences.

## 7. What is the difference between Session and Cookie?

- Session: 
    - Server-side
    - Maintains user state across multiple requests
    - Usually lasts until the user logs out or the browser is closed

- Cookie:
    - Client-side
    - Stores user information for tracking and personalization
    - Can be persistent (saved across sessions) or session-based (deleted when the browser is closed).

- In general, Session is server-side and short termed and Cookie is client-side and long term.

## 8. How do we use session and cookie to keep user information across the the application?

### 1. Using Session
- Server-side storage: Store user information (e.g., login status) in a session object on the server.

- Session ID: Send a unique session ID to the client via a cookie.

- Flow:
    - User logs in.
    - Server creates a session and stores user information.
    - Server sends a session ID to the client in a cookie.
    - Client sends the session ID with each request.
    - Server retrieves user information using the session ID.

### 2. Using Cookie

- Client-side storage: Store user information directly in cookies (e.g., preferences).

- Flow:
    - User sets a preference.
    - Server sends a cookie with the preference to the client.
    - Client stores the cookie.
    - Client sends the cookie with each request.
    - Server reads the cookie to get user information.

## 9. What is JWT?

- JWT (JSON Web Token) is a compact, URL-safe token used to securely transmit information between parties as a JSON object. It is commonly used for authentication and authorization, containing encoded, digitally signed, and optionally encrypted data, including claims about the user and metadata.

## 10. What is the spring security filter?

- The Spring Security filter is a component in the Spring Security framework that intercepts and processes HTTP requests and responses to enforce security measures such as authentication, authorization, and other security-related checks before allowing access to application resources.

## 11. Explain how JWT works?

### 1. User Authentication:
- User logs in with credentials.
- Server verifies credentials and generates a JWT.

### 2. Token Structure:
- JWT consists of three parts: Header, Payload, and Signature.
- Header: Specifies the token type (JWT) and signing algorithm.
- Payload: Contains claims (user data and metadata).
- Signature: Ensures the token's integrity and authenticity.

### 3. Token Transmission:
- Server sends the JWT to the client.
- Client stores the JWT (typically in local storage or a cookie).

### 4. Authenticated Requests:
- Client includes the JWT in the Authorization header of subsequent requests.

### 5. Token Verification:
- Server verifies the JWT's signature and extracts claims.
- If valid, server processes the request based on the claims.


## 12. Explain how do we store sensitive user information such as password and credit card number in DB?

### 1. Password

- Hashing: Use a strong, one-way hashing algorithm and never store plain text passwords.
- Salting: Add a unique salt to each password before hashing to prevent rainbow table attacks.
- Ex: 
```java
String hashedPassword = BCrypt.hashpw(plainPassword, BCrypt.gensalt());
```

### 2. Credit Card Number

- Encryption: Use strong encryption algorithms to encrypt credit card numbers and store the encryption keys securely, separate from the data.
- Tokenization: Replace credit card numbers with unique tokens. Store the tokens in the database and map them to the actual credit card numbers in a secure tokenization system.
- Ex:
```java
String encryptedCardNumber = encrypt(creditCardNumber, encryptionKey);
```

## 13. Compare UserDetailService, AuthenticationProvider, AuthenticationManager, AuthenticationFilter?(把这⼏个名字看熟悉也⾏)

- UserDetailService: 
    - Purpose: Loads user-specific data.
    - Function: Retrieves user details (e.g., username, password, roles) from a database or another source.
    - Usage: Typically used to fetch user information during authentication.

- AuthenticationProvider:
    - Purpose: Performs authentication logic.
    - Function: Validates user credentials and provides an authenticated Authentication object.
    - Usage: Checks the credentials (e.g., password) against the user details.

- AuthenticationManager:
    - Purpose: Coordinates authentication processes.
    - Function: Delegates authentication requests to one or more AuthenticationProvider instances.
    - Usage: Acts as a central point for managing authentication.

- AuthenticationFilter:
    - Purpose: Intercepts HTTP requests to perform authentication.
    - Function: Extracts authentication information (e.g., credentials) from HTTP requests and delegates to AuthenticationManager.
    - Usage: Part of the security filter chain to handle authentication for incoming requests.

## 14. What is the disadvantage of Session? how to overcome the disadvantage?

- Disadvantages:
    - Scalability: Sessions are stored server-side, leading to issues in distributed systems or load-balanced environments, where a user might be routed to different servers.
    - Resource Intensive: Consumes server memory, which can become a bottleneck with many users.

- How to overcome the disadvantage
    - Session Replication:
        - Share session data across servers using session replication mechanisms.
        - Drawback: Can be complex and increase network traffic.
    
    - Centralized Session Store:
        - Use a distributed in-memory data store to store sessions centrally.
        - Advantage: Ensures session data is accessible from any server.
    
    - Stateless Authentication:
        - Use JWT (JSON Web Tokens) to store user state on the client side.
        - Advantage: Eliminates the need for server-side session storage, improving scalability

## 15. How to get value from application.properties in Spring security?

- Using @Value Annotation:
```java
@Component
public class MyComponent {
    @Value("${property.name}")
    private String propertyName;
}
```

- Using @ConfigurationProperties:
```java
@Component
public class JwtUtil {
    private final JwtProperties jwtProperties;
    public JwtUtil(JwtProperties jwtProperties) {
        this.jwtProperties = jwtProperties;
    }
}
```

## 16. What is the role of configure(HttpSecurity http) and configure(AuthenticationManagerBuilder auth)?

- configure(HttpSecurity http):
    - Purpose: Configures HTTP security settings.
    - Function: Defines security constraints for HTTP requests, including URL access restrictions, form login, logout, CSRF protection, and more.
    - Usage: Customize how security is applied to different parts of the web application.
- Ex:
```java
@Override
protected void configure(HttpSecurity http) throws Exception {
    http
        .authorizeRequests()
            .antMatchers("/public/**").permitAll()
            .anyRequest().authenticated()
        .and()
        .formLogin()
            .loginPage("/login")
            .permitAll()
        .and()
        .logout()
            .permitAll();
}
```

- configure(AuthenticationManagerBuilder auth)
    - Purpose: Configures authentication mechanisms.
    - Function: Sets up the authentication provider, user details service, password encoder, and other authentication-related settings.
    - Usage: Define how users are authenticated (e.g., in-memory, JDBC, LDAP).
- Ex: 
```java
@Override
protected void configure(AuthenticationManagerBuilder auth) throws Exception {
    auth
        .inMemoryAuthentication()
            .withUser("user").password("{noop}password").roles("USER")
        .and()
            .withUser("admin").password("{noop}admin").roles("ADMIN");
}
```

## 17. What is Spring security authentication and authorization?

- Spring Security Authentication:
    - It is a Process of verifying user identity (e.g., username and password).
    - Ensures users are who they claim to be before accessing resources.
    - Logging in with credentials to access an application.

- Spring Security Authorization:
    - It is a Process of granting or denying access to resources based on user identity and permissions.
    - Controls what authenticated users are allowed to do within the application.
    - Allowing only administrators to delete user accounts.

- In general, Authentication verifies user identity and Authorization controls access to resources based on user permissions.