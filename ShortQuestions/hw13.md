# HW13

**3. What is the Aspect Oriented Programming, explain it with detailed use cases?**

AOP use precompile and dynamic proxy, which allow us to extend the feature of the application without change the business logic of the program. 

AOP is a wrapper, wrapper out methods which is not related to the business logic of program but are used in multiple classes, eg logging.

Use case:

Logging, Tracing, Exception handing, Security Management, Application Monitoring

**4. What are the advantages and disadvantages of Spring AOP?**

Advantage: 

simplified the code, easy intergration(dynamic weaving)

Disadvantage:

Performance overhead: the use of dynamic proxies can increase performance overhead.

**5. Explain following concept in your own words, you may include code snippet as part of your answer.**

1. Aspect: similar to @ControllerAdvice a module that encapsulates the behavior affecting multiple classes, like logger, caching, authentication..

```java
@Aspect
@Component
public class LoggingAspect {
    // 切面的方法定义
}
```

2. PointCut: Defines at what joinpoints, the associated advice should be applied

```java
@Pointcut("execution(* com.example.service.*.*(..))")
public void serviceLayer() {
}
```

3. JoinPoint: A joinpoint is a candidate point in the program execution of the application where an aspect can be plugged in.

4. Advice: Define When to execute aop methods when the application pointcut is found.

@Before – Run before the method execution

@After – Run after the method returned a result

@AfterReturning – Run after the method returned a result, intercept the returned result as well.

@AfterThrowing – Run after the method throws an exception

@Around – Run around the method execution, combine all three advices above, requires

ProceedingJoinPoint as parameter type in the advice method while above advice annotations requires JoinPoint as parameter type

```java
@Before("serviceLayer()")
public void logBeforeService(JoinPoint joinPoint) {
    Logger.log("Before executing service method: " + joinPoint.getSignature().getName());
}

@AfterReturning(pointcut = "serviceLayer()", returning = "result")
public void logAfterReturning(JoinPoint joinPoint, Object result) {
    Logger.log("Method returned value is : " + result);
}

@AfterThrowing(pointcut = "serviceLayer()", throwing = "error")
public void logAfterThrowing(JoinPoint joinPoint, Throwable error) {
    Logger.log("Method threw exception: " + error);
}

@Around("serviceLayer()")
public Object logAroundService(ProceedingJoinPoint joinPoint) throws Throwable {
    Logger.log("Before method: " + joinPoint.getSignature().getName());
    try {
        Object result = joinPoint.proceed();
        Logger.log("Successfully executed method: " + joinPoint.getSignature().getName());
        return result;
    } catch (IllegalArgumentException e) {
        Logger.log("Illegal argument " + Arrays.toString(joinPoint.getArgs()) + " in method: " + joinPoint.getSignature().getName());
        throw e;
    }
}
```

**6. How do we declare a pointcut, can we declare it without annotating an empty method? Name some expressions to do it.**

```java
@Aspect
public class MyAspect {
    @Pointcut("execution(* com.example.service.*.*(..))")
    public void myServiceMethods() {
        // This method is an empty placeholder used for pointcut definition
    }
}
```

**7. Compare different types of advices in Spring AOP.**

@Before: it will execute before the method begin execute.

@AfterReturning: it will execute after method finished

@AfterThrowing: If the method throw exception, it will execute

@After: Method will execute whether

@Around: Wrap the method, execute the aop method before and after the method.

**9. Spring WebFlux vs Stream API+CompletableFuture, why use Spring WebFlux over the other?**

Spring WebFlux and the combination of Stream API with CompletableFuture are both approaches used in Java to handle asynchronous and non-blocking operations. 

WebFlux use Reactive API, implements the Reactive Streams API for asynchronous stream processing with backpressure.

WebFlux includes a reactive WebClient for making non-blocking calls to other HTTP services

WebFlux is more suitable for concurrent request or stream data, but stream api is more focus on data processing and is not web specific.

**10. When to use Spring Batch? please provide detailed examples with business context.**

Spring batch is used in automated execution of batch processing, like data migration, periodic data processing, bulk updates, complex data transformation.

**11. How does Spring Batch work? you may include code snippet as part of your answer.**

![image.png](HW13%20db1df3648b75476eb066626cbee358cb/image.png)

A batch consist of one job, a job can consist of one or more steps. Step is a single task that should be executed, in a step, the application will read data through ItemReader, and process data with ItemProcessor, and write data with ItemWrite. Job launcher will start and process a job.

Job repository will store the setting and meta data of a job.

**12. How can we schedule a Spring Batch Job?**

1. enable scheduling

```java
import org.springframework.context.annotation.Configuration;
import org.springframework.scheduling.annotation.EnableScheduling;

@Configuration
@EnableScheduling
public class SchedulingConfig {
}
```

1. Schedule the job
    
    ```java
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.scheduling.annotation.Scheduled;
    import org.springframework.stereotype.Component;
    import org.springframework.batch.core.Job;
    import org.springframework.batch.core.JobParameters;
    import org.springframework.batch.core.JobParametersBuilder;
    import org.springframework.batch.core.launch.JobLauncher;
    
    @Component
    public class ScheduledTasks {
    
        @Autowired
        private JobLauncher jobLauncher;
    
        @Autowired
        private Job job;
    
        @Scheduled(cron = "0 0 12 * * ?")  // Schedules the job to run every day at noon
        public void runJob() {
            JobParameters params = new JobParametersBuilder()
                .addString("JobID", String.valueOf(System.currentTimeMillis()))
                .toJobParameters();
            try {
                jobLauncher.run(job, params);
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }
    ```
    

**13. What is the cron expression?**

A cron expression is a string composed of six or seven fields separated by whitespace that represents a set of times, normally as a schedule to execute some routine. 

**14. Explain Spring task?**

Spring Task is a lightweight scheduled task tool provided by Spring. It can be used in Data backup, Order automatically cancelled if not paid, Periodic push information, Publish articles regularly, Generate reports periodically..

**15. What is Filter and any filter example?**

A filter is a component that performs filtering tasks on either the request to a server or on the response from a server before it is sent back to the client.

Core component of filter:

init(FilterConfig filterConfig): Used for filter configuration and initialization. It is called once when the filter is first loaded.

doFilter(ServletRequest request, ServletResponse response, FilterChain chain): The core of the filter where the request and response are processed.

destroy(): Called when a filter is taken out of service and is used for cleanup activities.

Filter can be used in Authentication, logging, image conversion, data compression etc

**16. What is the Interceptor? What we can do with interceptor?**

Interceptors are used for tasks that require modification, inspection, or augmentation of request and response objects within the context of an MVC framework. 

Compare with Filter, Filters are based on the Servlet API and can be applied to any request coming into the servlet container,Interceptors are deeply integrated with the MVC lifecycle, and they can interact with the MVC-specific contexts like model data and controller metadata.

It can be used in Authentication/Authorisation, logging, performance monitor, modified request etc..

**17. In Interceptor, What is preHandle? What is postHandle?**

The preHandle method is called before the actual handler (controller) is executed. It is part of the HandlerInterceptor interface.

The postHandle method is called after the handler (controller) executes but before the view is rendered. 

**18. What is Swagger, why do we need it? What does it do except "documentation"?**

Swagger is used to design, build, document, and consume REST APIs, enable developers to deliver well-documented, robust APIs that are easy for other developers to understand and use. 

It can also do API Mocking, API security schemes etc